console.log(" %c Theme onecircle %c https://github.com/gogobody/onecircle","color:#444;background:#eee;padding:5px 0","color:#eee;background:#444;padding:5px");var stripscript=function(t){for(var e=new RegExp("[`^()|{}'\\[\\].<>/?~！……*——|{}‘”“↵\r\n]"),n="",i=0;i<t.length;i++)n+=t.substr(i,1).replace(e,"");return n};$(function(){$('[data-toggle="tooltip"]').tooltip(),$.extend({message:function(t){var e={title:"",message:" 操作成功",time:"3000",type:"success",showClose:!0,autoClose:!0,onClose:function(){}};"string"==typeof t&&(e.message=t),"object"==typeof t&&(e=$.extend({},e,t));var n,i=e.showClose?'<div class="c-message--close">×</div>':"",t=""!==e.title?'<h2 class="c-message__title">'+e.title+"</h2>":"",t='<div class="c-message animated animate__slideInRight"><i class=" c-message--icon c-message--'+e.type+'"></i><div class="el-notification__group">'+t+'<div class="el-notification__content">'+e.message+"</div>"+i+"</div></div>",i=$("body"),a=$(t),o=function(){a.addClass("animate__slideOutRight"),a.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){s()})},s=function(){a.remove(),e.onClose(e),clearTimeout(n)};$(".c-message").remove(),i.append(a),a.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){a.removeClass("messageFadeInDown")}),i.on("click",".c-message--close",function(t){o()}),e.autoClose&&(n=setTimeout(function(){o()},e.time))},showloading:function(t){var e=$.extend({},{selector:"header",choice:"append"},t),n='<div class="loading-container"><svg width="120" height="12px" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg" fill="#03A9F5" class="loading-svg"><circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle></svg></div>';"string"==typeof e.selector&&(t=$(e.selector),"append"===e.choice?t.append(n):"prepend"===e.choice?t.prepend(n):"after"===e.choice?t.after(n):"before"===e.choice&&t.before(n))},rmloading:function(){$(".loading-container").remove()}})});var indexInput={init:function(){this.loginUserName="",this.addArea=$(".add-area"),this.addAreaBtn=$(".add-area button"),this.addPicBtn=$("#addpic"),this.addLinkBtn=$("#addlink"),this.addVideoBtn=$("#addvideo"),this.addBilibiliBtn=$("#addbilibili"),this.uploadPic=$(".upload-pic"),this.showPanel=$(".show-panel.fbjukw"),this.additionArray=[],this.nowtype="default",this.articleType=$("#articleType"),this.funcInit()},funcInit:function(){this.indexEventInit(),this.login_ajax(),this.searchEventInit(),this.articleClickInit(),this.asideEventInit()},resetInputStatus:function(){this.additionArray=[]},changeType:function(t){this.nowtype!==t&&(this.nowtype=t,this.articleType.val(t),this.resetInputStatus(),$(".add-area input").val(""))},doParseDefaultFunc:function(t,e){$(t).html("解析中");var n,i=$(".add-area input"),a=i.val();checkURL(a)?(n='<div class="sc-AxjAm sc-AxirZ ciIrlj">\n<div class="eHTuZC" style="background-image: url('+a+');">\n<div class="cPHQWG">\n<svg viewBox="0 0 17 17" fill="currentColor">\n<path d="M9.565 8.595l5.829 5.829a.686.686 0 01-.97.97l-5.83-5.83-5.828 5.83a.686.686 0 01-.97-.97l5.829-5.83-5.83-5.828a.686.686 0 11.97-.97l5.83 5.829 5.829-5.83a.686.686 0 01.97.97l-5.83 5.83z"></path>\n</svg>\n</div>\n</div>\n</div>',e.showPanel.append(n),e.additionArray.push(a),e.addPicBtn.siblings().addClass("btn-disable"),i.val(""),$(".cPHQWG").unbind("click").bind("click",function(){var t=$(this).parent().css("backgroundImage").replace("url(","").replace(")","");e.additionArray.splice($.inArray(t,e.additionArray),1),$(this).parent().parent().remove(),0===e.additionArray.length&&e.addPicBtn.siblings().removeClass("btn-disable")})):$.message({title:"提示",message:"请输入正确的图片地址",type:"error"}),$(t).html("添加")},doParseLinkFunc:function(n,i){$(n).text("解析中");var a=$(".add-area input").val();checkURL(a)?$.post(gconf.oneaction,{type:"parsemeta",url:a},function(t){var e;t.code?((e=$(".sc-AxjAm.kgcKxQ")).css("display","block"),e.attr("href",a),$(".sc-AxjAm.kgcKxQ .hHnMup").html(t.data),i.additionArray=[],i.additionArray.push(a),i.additionArray.push(stripscript(t.data)),$(n).text("添加"),i.addLinkBtn.siblings().addClass("btn-disable"),$(".sc-AxjAm.sc-AxirZ.ezTcmd").unbind("click").bind("click",function(t){return $(".kgcKxQ").css("display","none"),t.stopPropagation(),i.addLinkBtn.siblings().removeClass("btn-disable"),!1})):($.message({title:"提示",message:"解析失败",type:"error"}),console.log(t)),$(n).text("添加")}):($.message({title:"提示",message:"请输入正确的地址",type:"error"}),$(n).text("添加"))},doParseVideoFunc:function(t,e){var n=$(".add-area input"),i=n.val();checkURL(i)?(e.additionArray.push(i),i='<div class="show-panel-inner"><div class="jLaetV"><div class="hHnMup">'+i+'</div></div>\n<div class="ezTcmd show-close">\n<div class="hyliOy">\n<svg viewBox="0 0 17 17" fill="#ccc">\n<path d="M9.565 8.595l5.829 5.829a.686.686 0 01-.97.97l-5.83-5.83-5.828 5.83a.686.686 0 01-.97-.97l5.829-5.83-5.83-5.828a.686.686 0 11.97-.97l5.83 5.829 5.829-5.83a.686.686 0 01.97.97l-5.83 5.83z"></path>\n</svg>\n</div>\n</div></div>',e.showPanel.append(i),e.addVideoBtn.siblings().addClass("btn-disable"),n.val(""),$(".show-close").unbind("click").bind("click",function(){var t=$(this).siblings().text();e.additionArray.splice($.inArray(t,e.additionArray),1),$(this).parent().remove(),0===e.additionArray.length&&e.addVideoBtn.siblings().removeClass("btn-disable")})):$.message({title:"提示",message:"请输入正确的视频地址",type:"error"})},doParseBilibiliFunc:function(t,e){var n=$(".add-area input"),i=n.val();e.additionArray.push(i);i='<div class="show-panel-inner"><div class="jLaetV"><div class="hHnMup">'+i+'</div></div>\n<div class="ezTcmd show-close">\n<div class="hyliOy">\n<svg viewBox="0 0 17 17" fill="#ccc">\n<path d="M9.565 8.595l5.829 5.829a.686.686 0 01-.97.97l-5.83-5.83-5.828 5.83a.686.686 0 01-.97-.97l5.829-5.83-5.83-5.828a.686.686 0 11.97-.97l5.83 5.829 5.829-5.83a.686.686 0 01.97.97l-5.83 5.83z"></path>\n</svg>\n</div>\n</div></div>';e.showPanel.append(i),e.addBilibiliBtn.siblings().addClass("btn-disable"),n.val(""),$(".show-close").unbind("click").bind("click",function(){var t=$(this).siblings().text();e.additionArray.splice($.inArray(t,e.additionArray),1),$(this).parent().remove(),0===e.additionArray.length&&e.addBilibiliBtn.siblings().removeClass("btn-disable")})},indexEventInit:function(){var e=this;$("#addpic").unbind("click").bind("click",function(){$(".add-area input").attr("placeholder","请输入图片链接"),"default"!==e.nowtype?(e.addArea.show(),e.uploadPic.show()):(e.addArea.toggle(),e.uploadPic.toggle()),e.changeType("default")}),$("#addlink,#addvideo,#addbilibili").unbind("click").bind("click",function(){e.uploadPic.hide();var t=$(this).data("type");"link"===t?$(".add-area input").attr("placeholder","请输入链接"):"video"===t?$(".add-area input").attr("placeholder","请输入视频链接"):"bilibili"===t&&$(".add-area input").attr("placeholder","请输入bv号"),e.nowtype!==t?e.addArea.show():e.addArea.toggle(),e.changeType(t)}),this.addAreaBtn.unbind("click").bind("click",function(){"default"===e.nowtype?e.doParseDefaultFunc(this,e):"link"===e.nowtype?e.doParseLinkFunc(this,e):"video"===e.nowtype?e.doParseVideoFunc(this,e):"bilibili"===e.nowtype&&e.doParseBilibiliFunc(this,e)}),$("#text").bind("input propertychange",function(){var t=$(".pub.eynkqj");$(this).val()?t.removeAttr("disabled"):(t.attr("disabled",!0),t.css("background-color","rgb(255, 241, 147)"))}),$(".sc-AxjAm.bwpEWU.gsmhQy").bind("input propertychange",function(){var t=$(".sc-AxjAm.eVNRGW");$(this).val()?t.removeAttr("disabled"):t.attr("disabled",!0)});var o=$("#topic-search-downshift-input");o.autoComplete({minChars:0,source:function(t,e){t=t.toLowerCase();for(var n=allCategories,i=[],a=0;a<n.length;a++)~n[a][0].toLowerCase().indexOf(t)&&i.push(n[a]);0===i.length&&i.push(["未搜索到结果",-1,"",""]),e(i)},renderItem:function(t,e){var n=new Array;return n[0]=t[0],n[1]=t[1],-1===t[1]?'<div class="autocomplete-suggestion" data-val="'+JSON.stringify(n).replace(/"/g,"'")+'" disabled><div class="sc-AxjAm oDrAC" disabled>'+t[0]+"</div></div>":'<div class="autocomplete-suggestion" data-val="'+JSON.stringify(n).replace(/"/g,"'")+'"><img src="'+t[2]+'" class="sc-AxjAm gLHjJQ"><div class="sc-AxjAm oDrAC">'+t[0]+"</div></div>"},onSelect:function(t,e,n){e=e.replace(/'/g,'"');var i=JSON.parse(e),a=i[1],e=$("#category");if(-1===a)return $("#topic-search-downshift-input").val(""),void e.val(1);o.val(i[0]),e.val(a)}}),$(".post-content-inner-link a").click(function(t){t.stopPropagation()})},searchEventInit:function(){var t=$(".search-block-icon"),e=$("#search-block");t.unbind("click").bind("click",function(){"none"===e.css("display")?e.slideDown():$(".search-block").slideUp()}),$(".close").unbind("click").bind("click",function(){$(".search-block").slideUp()})},login_ajax:function(){var i=this,a=$("#login-submit"),o=$("#navbar-login-user"),s=$("#navbar-login-password");function r(){a.attr("disabled",!0).fadeTo("",1)}function l(){a.attr("disabled",!1).fadeTo("",1)}this.canLogin=!0,$("#Login_form").submit(function(){if(i.canLogin){i.canLogin=!1;var e=this;if($(this).hasClass("banLogin"))return location.reload(),!1;a.attr("disabled",!0).fadeTo("slow",.5);var n=o.val(),t=s.val();return""===n?(i.canLogin=!0,$.message({title:"登录通知",message:"必须填写用户名",type:"warning"}),o.focus(),r()):""===t?(i.canLogin=!0,$.message({title:"登录通知",message:"请填写密码",type:"warning"}),s.focus(),r()):(a.addClass("active"),$("#spin-login").addClass("show inline"),$.post(gconf.oneaction,{type:"getsecurl",url:window.location.href},function(t){return t.code?($("#Login_form").attr("action",t.data),void $.ajax({url:t.data,type:$(e).attr("method"),data:$(e).serializeArray(),error:function(){return i.canLogin=!0,$.message({title:"登录通知",message:"提交出错",type:"error"}),l()},success:function(t){t=$.parseHTML(t),a.removeClass("active"),$("#spin-login").removeClass("show inline");try{if($("#Logged-in",t).length<=0)return i.canLogin=!0,l(),$.message({title:"登录通知",message:"用户名或者密码错误，请重试",type:"error"});r(),t=$("#easyLogin",t).html(),$("#easyLogin").html(t),$.message({title:"登录通知",message:'登录成功:&nbsp;<a onclick="location.reload();">点击这里刷新页面，或等待自动刷新</a>',type:"success"}),i.canLogin=!0,i.loginUserName=n,setTimeout(function(){location.reload()},500)}catch(t){alert("按下F12，查看输出错误信息"),i.canLogin=!0}}})):$.message({title:"提示",message:"获取securl失败",type:"error"})})),!1}})},loginBan:function(){var t=$("#Login_form");t.hasClass("banLogin")||(t.addClass("banLogin"),$("#navbar-login-user").attr("disabled","disabled"),$("#navbar-login-password").attr("disabled","disabled"))},resetLoginAction:function(e){0<userId||$.post(gconf.oneaction,{type:"getsecurl",url:window.location.href},function(t){return t.code?($("#Login_form").attr("action",t.data),void e()):$.message({title:"提示",message:"获取securl失败",type:"error"})})},articleClickInit:function(){$.support.pjax&&$("article[do-pjax]").unbind().bind("click",function(t){var e=$(this).data("url");"IMG"===t.target.tagName||$.pjax({url:e,container:"#pjax-container"})}),$(".content-action").each(function(e,t){$(t).find(".btn-like").on("click",function(t){return $(this).get(0).disabled=!0,$.ajax({url:$(this).data("link"),type:"post",data:"agree="+$(this).attr("data-cid"),async:!0,timeout:3e4,cache:!1,success:function(t){/\d/.test(t)&&$($(".btn-like").find("span.agree-num")[e]).html(t)},error:function(){$(this).get(0).disabled=!1}}),t.stopPropagation(),!1})})},asideEventInit:function(){var t=$(".aside-btn"),e=$("#aside"),n=$("footer");t.unbind("click").bind("click",function(){e.hasClass("off-screen")?(e.removeClass("off-screen"),n.show()):(e.addClass("off-screen"),n.hide())}),$(".off-screen-toggle").unbind("click").bind("click",function(){$("#aside").toggleClass("off-screen")}),$("#aside .nav-menu").unbind("click").bind("click",function(){$("#aside").toggleClass("off-screen")})},pjax_complete:function(){this.init()}},archiveInit={init:function(){this.funcInit()},funcInit:function(){this.archiveEventInit(),this.commentInit(),this.fansFuncInit(),this.circleFuncInit(),this.repostFuncInit(),this.archAuthorTabShowInit(),this.archAuthorTabsClickInit(),this.iasInit(),this.lazyloadInit()},postRepostArticle:function(t,e,n,i,a,o){if(userId<0)return $.message({title:"提示",message:"请登录后操作",type:"error"}),!1;postArticle({title:indexInput.loginUserName+"转发了"+a.substring(0,20),text:'[repost href="'+t+'" bannerimg="'+n+'" repousername="'+i+'" repostext="'+a+"\" category='"+o+"']","fields[articleType]":"repost","fields[excerpt]":e,markdown:1,"category[]":1,visibility:"publish",allowComment:1,allowPing:1,allowFeed:1,do:"publish"},!1)},repostFuncInit:function(){var r=$("#repostComment");$(".share-btn").unbind("click").bind("click",function(t){$("#repostModal").modal("show"),$("#repostModal").on("shown.bs.modal",function(){r.focus()})}),$("#repostBtn").unbind("click").bind("click",function(t){var e=r.val(),n=r.data("posthref"),i=/src=[\'\"]?([^\'\"]*)[\'\"]?/i,a=$(".article-content").html().match(/<img.*?(?:>|\/>)/i),o="";a&&0<a.length&&((s=a[0].match(i))&&0<s.length&&(o=s[1]));a=o.match(i);a&&0<a.length&&(o=a[1]);var s=r.data("username"),i=r.data("excerpt"),a=r.data("category");"undefine"===i&&(i=""),archiveInit.postRepostArticle(n,e,o,s,i,a),$("#repostModal").modal("hide")}),$(".repost-row a").unbind("cilck").bind("click",function(t){var e=$(this).attr("href");$.pjax({url:e,container:"#pjax-container"}),t.stopPropagation()})},postFansArticle:function(n,i,a,o){$.post(gconf.oneaction,{type:"getfocusmid"},function(t){var e;t?(e=parseInt(t),postArticle({title:indexInput.loginUserName+"关注了圈友"+a,text:'[focususer href="'+n+'" avatar="'+i+'" username="'+a+'" sign="'+o+'" ]',"fields[articleType]":"focususer","fields[excerpt]":"关注了圈友"+a,markdown:1,"category[]":e,visibility:"publish",allowComment:1,allowPing:1,allowFeed:1,do:"publish"},!1)):console.log(t)})},fansFuncInit:function(){var t=$(".fan-event"),r=this;t.unbind("click").bind("click",function(t){var e,o,s;0<userId?(e=parseInt($(this).data("authorid")),o="关注"===$.trim($(this).text())?"follow":"unfollow",parseInt(userId)!==e?($(this).attr("disabled",!0),s=this,$.post(gconf.index,{followuser:1,follow:o,uid:userId,fid:e},function(t){var e,n,i,a;t&&("unfollow"===o?($(s).text("关注"),$(s).addClass("fans"),$(s).removeClass("fansed")):($(s).text("已关注"),$(s).addClass("fansed"),$(s).removeClass("fans"),Math.random()<=.3&&(a=$(s).attr("data-author_page")?(e=$(s).parent().siblings().data("authorhref"),n=$(".author-avatar").attr("src"),i=$(".author_page-name").text(),$(".author-sign").text()):(e=(a=$(s).parent().siblings()).attr("href"),n=a.children("img").attr("src"),i=a.children("div").children(".oDrAC").text(),a.children("div").children(".ezzhLs").text()),r.postFansArticle(e,n,i,a)))),$(s).attr("disabled",!1)})):$.message({title:"提示",message:"自己不能关注自己！",type:"warning"})):$.message({title:"提示",message:"没有登录！",type:"warning"})})},circleFuncInit:function(){$(".circle-event").unbind("click").bind("click",function(t){var e,n,i;0<userId?(e=parseInt($(this).data("categoryid")),n="加入"===$.trim($(this).text())?"follow":"unfollow",$(this).attr("disabled",!0),i=this,$.post(gconf.index,{followcircle:1,follow:n,uid:userId,mid:e},function(t){t&&("unfollow"===n?($(i).text("加入"),$(i).addClass("fans"),$(i).removeClass("fansed")):($(i).text("已加入"),$(i).addClass("fansed"),$(i).removeClass("fans"))),$(i).attr("disabled",!1)})):$.message({title:"提示",message:"没有登录！",type:"warning"})})},archAuthorTabShowInit:function(){var n=$(".react-tabs__tab-list"),i=n.find("li:first-child");0<n.length&&setTimeout(function(){var t=n.first().offset().left,e=i.first().offset().left-t,t=$(".line");t.css({transform:"translateX("+e+"px)"}),t.show()},100)},archiveLoadRebindInit:function(){archiveInit.fansFuncInit(),indexInput.articleClickInit(),archiveInit.lazyloadInit()},archAuthorTabsClickInit:function(){var a,o,t=$(".react-tabs__tab-list");0<t.length&&(a=t.first().offset().left,o=$(".line"),t.children().each(function(t,n){$(n).click(function(t){var i=$(n).data("tabindex");$(this).addClass("react-tabs__tab--selected").siblings().removeClass("react-tabs__tab--selected"),o.width($(n).width());var e=$(n).offset().left-a;o.css({transform:"translateX("+e+"px)"}),$.ajax({url:"?tabindex="+i,method:"get",success:function(t){var e=$.parseHTML(t);try{var n=$(".item-container",e);if(n.length<=0)return $.message({title:"通知",message:"服务器返回错误，请重试",type:"error"});n=n.html();$(".pagination",e).length<=0&&(1===i||2===i)?$(".pagination").css("display","none"):0<$(".pagination",e).length&&(0===i||3===i)&&$(".pagination").css("display","flex"),$(".item-container").html(n);n=$(".archive-content");n.removeClass(function(t,e){return(e.match(/(^|\s)tabindex-\S+/g)||[]).join("")}),n.addClass("tabindex-"+i),archiveInit.archiveLoadRebindInit()}catch(t){console.log(t)}}})})}))},archiveEventInit:function(){$("#agree-btn").on("click",function(){$(this).get(0).disabled=!0,$(this).children().css("fill","rgb(228, 88, 62)"),$.ajax({url:gconf.index,type:"post",data:"agree="+$(this).attr("data-cid"),async:!0,timeout:3e4,cache:!1,success:function(t){/\d/.test(t)&&$(".agree-num").html(t)},error:function(){$(this).get(0).disabled=!1}})})},commentInit:function(){var e=$("html,body"),n=".comment-list",i=".comment-num",a=".comment-reply a",o="",s="";c();var r=$("#comment-form"),l=$(".submit.btn.comment-submit");function c(){$(a).click(function(){s=$(this).parent().parent().parent().attr("id")}),$("#cancel-comment-reply-link").click(function(){s=""})}l.unbind("click").bind("click",function(t){$(this).attr("disabled",!0),r.submit()}),r.submit(function(){var t=$(this).serializeArray();return""===$.trim(t[0].value)?($.message({title:"提示",message:"请输入内容",type:"error"}),l.attr("disabled",!1)):$.ajax({url:$(this).attr("action"),type:"post",data:$(this).serializeArray(),error:function(){return alert("提交失败，请检查网络并重试或者联系管理员。"),l.attr("disabled",!1),!1},success:function(t){if(l.attr("disabled",!1),!$(n,t).length)return alert("您输入的内容不符合规则或者回复太频繁，请修改内容或者稍等片刻。"),!1;o=$(n,t).html().match(/id=\"?comment-\d+/g).join().match(/\d+/g).sort(function(t,e){return t-e}).pop(),$(".page-navigator .prev").length&&""==s&&(o=""),s?(t=$("#comment-"+o,t).hide(),$("#"+s).find(".comment-children").length<=0&&$("#"+s).append("<div class='comment-children'><ol class='comment-list'></ol></div>"),o&&$("#"+s+" .comment-children .comment-list").prepend(t),s=""):(t=$("#comment-"+o,t).hide(),$(n).length||$(".comment-detail").prepend("<h2 class='comment-num'>0 条评论</h2><ol class='comment-list'></ol>"),$(n).prepend(t)),$("#comment-"+o).fadeIn(),$(i).length&&(t=parseInt($(i).text().match(/\d+/)),$(i).html($(i).html().replace(t,t+1))),TypechoComment.cancelReply(),$("#textarea").val(""),$(a+", #cancel-comment-reply-link").unbind("click"),c(),o?e.animate({scrollTop:$("#comment-"+o).offset().top-50},300):e.animate({scrollTop:$("#comments").offset().top-50},300)}}),!1})},lazyloadInit:function(){},iasInit:function(){var i=$(".a-pageLink .next");0<i.length||i.attr("style","display:none"),i.unbind("click").bind("click",function(){var t=$(this).attr("href"),n=$(".a-pageLink .donut");return void 0!==t&&$.ajax({url:t,type:"get",beforeSend:function(){i.hide(),n.fadeIn()},error:function(t){},success:function(t){var e=$(t).find(".post-article");n.hide(),$(".list").append(e).fadeIn();t=$(t).find(".a-pageLink .next").attr("href");void 0!==t?(i.attr("href",t),i.fadeIn()):(i.attr("style","display:none"),$(".a-pageLink").append('<a href="javascript:;" rel="nofollow">加载完毕</a>')),archiveInit.archiveLoadRebindInit()}}),!1});var a=$(".a-pageLink .comments-next");0<a.length||a.attr("style","display:none"),a.unbind("click").bind("click",function(){var t=$(this).attr("href"),n=$(".a-pageLink .donut");return void 0!==t&&$.ajax({url:t,type:"get",beforeSend:function(){a.hide(),n.fadeIn()},error:function(t){},success:function(t){var e=$(t).find(".comment-detail>.comment-list>.comment-list-item");n.hide(),$(".comment-detail>.comment-list").append(e).fadeIn();t=$(t).find(".a-pageLink .comments-next").attr("href");void 0!==t?(a.attr("href",t),a.fadeIn()):(a.attr("style","display:none"),$(".a-pageLink").append('<a href="javascript:;" rel="nofollow">加载完毕</a>'))}}),!1})},pjax_complete:function(){this.archiveEventInit(),this.commentInit(),this.repostFuncInit(),this.archAuthorTabShowInit(),this.iasInit(),this.lazyloadInit()}},recommendInit={init:function(){this.autoDirayWith()},autoDirayWith:function(){for(var t=document.getElementsByClassName("diary-item"),e=0;e<t.length;e++)t[e].style.height=t[e].offsetWidth+"px"},pjax_complete:function(){this.autoDirayWith()}},tagsManageInit={init:function(){this.circleEditBtn()},circleEditBtn:function(){var t=$(".circle-item .edit-btn button"),e=$("#circle-edit-save"),n=-1;t.unbind("click").bind("click",function(t){n=parseInt($(this).data("categoryid"));var e=$(this).data("name");$("#selectCircle").val(e),$("#changeCatagModal").modal("show")}),e.unbind("click").bind("click",function(t){var e;0<!n||(e=$("#changeCircle").val(),$.ajax({data:{url:gconf.index,changeCircleCat:1,mid:n,changetomid:e},method:"POST",success:function(t){"success"===t&&$.message({title:"通知",message:"更改成功，刷新后可见",type:"info"}),$("#changeCatagModal").modal("hide")},error:function(t){console.log(t),$("#changeCatagModal").modal("hide")}}))})},pjax_complete:function(){this.circleEditBtn()}},oneMap={AMapUrl:"https://webapi.amap.com/loader.js",init:function(t){if(!t)return!1;this.AMap=t,this.autoCompleteInit(t),this.geolocationInit(t),this.mapContainerInit(t,this.geolocation)},pjax_complete:function(){oneMap.AMap?(oneMap.autoCompleteInit(oneMap.AMap),oneMap.mapContainerInit(oneMap.AMap,oneMap.geolocation)):$.getScript(oneMap.AMapUrl,function(){oneMap.amapLoadInit()}),this.restoreFromLocal()},amapLoadInit:function(){var e;userId<0||((e=new XMLHttpRequest).open("POST",gconf.oneaction,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send("type=amapKey"),e.onreadystatechange=function(){var t;4===e.readyState&&200===e.status&&(t=e.responseText,(t=JSON.parse(t)).status?(localStorage.setItem("amapkey",t.data),AMapLoader.load({key:t.data.jskey,version:"1.4.15",plugins:["AMap.Autocomplete","AMap.Geolocation","AMap.Geocoder","AMap.Marker"]}).then(function(t){oneMap.init(t)}).catch(function(t){console.error(t),$.message({type:"error",title:"提示",message:"获取amapJsKey失败"})})):console.log(t))})},restoreFromLocal:function(){var t,e,n=localStorage.getItem("address");n&&(n=JSON.parse(n),(t=document.getElementById("ad-address"))&&((e=document.getElementById("address-input")).value=n.name,e.style.width="fit-content",document.getElementById("ad-name").value=n.name,document.getElementById("ad-district").value=n.district,t.value=n.address))},save2local:function(t,e,n){n=JSON.stringify({name:t,district:e,address:n});localStorage.setItem("address",n)},geolocationInit:function(i){var t=new i.Geolocation({enableHighAccuracy:!0,position:"RB",buttonOffset:new i.Pixel(10,20),zoomToAccuracy:!0,getCityWhenFail:!0,needAddress:!0});(this.geolocation=t).getCurrentPosition(function(t,e){var n;"complete"===t?!e.status||(n=document.getElementById("address-input"))&&(new i.Autocomplete).search(e.formattedAddress,function(t,e){0<e.count&&(n.value=e.tips[0].name,n.style.width="fit-content",document.getElementById("ad-name").value=e.tips[0].name,document.getElementById("ad-district").value=e.tips[0].district,document.getElementById("ad-address").value=e.tips[0].address,oneMap.save2local(e.tips[0].name,e.tips[0].district,e.tips[0].address))}):$.message({title:"定位失败",message:"失败原因排查信息:"+e.message,type:"error"})})},autoCompleteInit:function(t){var e=document.getElementById("ad-name");e&&(this.autoComplete=new t.Autocomplete({city:"全国",input:"address-input"}),this.autoComplete.on("select",function(t){e.value=t.poi.name,document.getElementById("ad-district").value=t.poi.district,document.getElementById("ad-address").value=t.poi.address,oneMap.save2local(t.poi.name,t.poi.district,t.poi.address)}))},mapContainerInit:function(t,e){var n,i;this.geocoder&&this.marker||(this.geocoder=new t.Geocoder({}),this.marker=new t.Marker),document.getElementById("amap-container")&&(n=new t.Map("amap-container",{resizeEnable:!0,zoom:15,mapStyle:"amap://styles/fresh"}),(t=utils.getQueryString("name"))?(i=this.marker,this.geocoder.getLocation(district+t,function(t,e){"complete"===t&&e.geocodes.length?(e=e.geocodes[0].location,i.setPosition(e),n.add(i),n.setFitView(i)):console.error("根据地址查询位置失败")})):n.addControl(e))}},floatEle={init:function(){this.fabtns=$("#float_action_buttons"),this.backToTopBtn=$("#fabtn_back_to_top"),this.toggleSidesBtn=$("#fabtn_toggle_sides"),this.readingProgressBar=$("#fabtn_reading_progress_bar"),this.readingProgressDetails=$("#fabtn_reading_progress_details"),this.goToComment=$("#fabtn_go_to_comment"),this.isScrolling=!1,this.eventInit(),this.changefabtnDisplayStatus()},eventInit:function(){var t=this;this.backToTopBtn.on("click",function(){floatEle.isScrolling||(floatEle.isScrolling=!0,setTimeout(function(){floatEle.isScrolling=!1},600),$("body,html").animate({scrollTop:0},600))}),0<$("#comment").length?$("#fabtn_go_to_comment").removeClass("d-none"):$("#fabtn_go_to_comment").addClass("d-none"),this.goToComment.on("click",function(){gotoHash("#comment",600),$("#post_comment_content").focus()}),"left"===localStorage.Argon_fabs_Floating_Status&&this.fabtns.addClass("fabtns-float-left"),this.toggleSidesBtn.on("click",function(){t.fabtns.addClass("fabtns-unloaded"),setTimeout(function(){t.fabtns.toggleClass("fabtns-float-left"),t.fabtns.hasClass("fabtns-float-left")?localStorage.Argon_fabs_Floating_Status="left":localStorage.Argon_fabs_Floating_Status="right",t.fabtns.removeClass("fabtns-unloaded"),t.hideAlltoolTip()},300)}),this.fabtns.removeClass("fabtns-unloaded")},changefabtnDisplayStatus:function(){var t=$(window).scrollTop()/Math.max($(document).height()-$(window).height(),.01);this.readingProgressDetails.html((100*t).toFixed(0)+"%"),this.readingProgressBar.css("width",(100*t).toFixed(0)+"%"),400<=$(window).scrollTop()||.5<=t?this.backToTopBtn.removeClass("fabtn-hidden"):this.backToTopBtn.addClass("fabtn-hidden")},hideAlltoolTip:function(){$("#float_action_buttons button").tooltip("hide")}},blog={init:function(){this.init_load_more()},pjax_complete:function(){this.init_load_more()},eventInit:function(){},init_load_more:function(){var t=$(".j-loadmore a");t.attr("data-href",t.attr("href")),t.removeAttr("href"),t.on("click",function(){var t,n;$(this).attr("disabled")||($(this).html("loading..."),$(this).attr("disabled",!0),t=$(this).attr("data-href"),n=this,t&&$.ajax({url:t,type:"get",success:function(t){$(n).removeAttr("disabled"),$(n).html("查看更多");var e=$(t).find(".article-list:not(.sticky)");$(".j-index-article.article").append(e);t=$(t).find(".j-loadmore a").attr("href");t?$(n).attr("data-href",t):$(".j-loadmore").remove()}}))})}},utils={getQueryString:function(t){t=t.replace(/[]/,"[").replace(/[]/,"[").replace(/[]/,"\\]");t=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.parent.location.href);return null==t?"":decodeURI(t[1])},debounce:function(e,n,i){var a,o,s,r,l;function c(){var t=Date.now()-r;t<n&&0<=t?a=setTimeout(c,n-t):(a=null,i||(l=e.apply(s,o),s=o=null))}null==n&&(n=100);function t(){s=this,o=arguments,r=Date.now();var t=i&&!a;return a=a||setTimeout(c,n),t&&(l=e.apply(s,o),s=o=null),l}return t.clear=function(){a&&(clearTimeout(a),a=null)},t.flush=function(){a&&(l=e.apply(s,o),s=o=null,clearTimeout(a),a=null)},t}};$(function(){$(window).unbind("scroll").bind("scroll",function(){floatEle.changefabtnDisplayStatus()}),window.onscroll=utils.debounce(function(){floatEle.hideAlltoolTip()},300),indexInput.init(),tagsManageInit.init(),recommendInit.init(),archiveInit.init(),floatEle.init(),blog.init()});var pjaxInit=function(){indexInput.pjax_complete(),archiveInit.init(),recommendInit.pjax_complete(),owoInit(),tagsManageInit.pjax_complete(),oneMap.pjax_complete(),blog.pjax_complete(),$("article.post")&&Prism.highlightAll()};function postArticle(e,n){$.post(gconf.oneaction,{type:"getsecuritytoken"},function(t){return t.code?$.ajax({url:gconf.index+"/action/contents-post-edit?do=publish&_="+t.data,type:"post",data:e,success:function(t){n&&setTimeout(function(){$.pjax.reload("#pjax-container",{container:"#pjax-container",fragment:"#pjax-container",timeout:8e3}),$.message({title:"提示",message:"发布成功，没出来的话就刷新一下吧",type:"success"})},800)},error:function(t){return $.message({title:"提示",message:"code:"+t.status+"err:"+t.responseText+t,type:"error"})}}):$.message({title:"提示",message:"请检查插件是否正确安装！",type:"error"}),!1})}function delComments(e,n){return confirm("您真的确定要删除吗？")&&$.post(gconf.oneaction,{type:"getsecuritytoken"},function(t){return"error"!==t&&$.ajax({url:gconf.index+e+"&_="+t,type:"post",success:function(t){return n&&setTimeout(function(){$.pjax.reload("#pjax-container",{container:"#pjax-container",fragment:"#pjax-container",timeout:8e3}),$.message({title:"提示",message:"删除成功",type:"success"})},800),t.success&&$.message({title:"提示",message:"删除成功",type:"success"}),!1},error:function(t){return $.message({title:"提示",message:"code:"+t.status+"err:"+t.responseText+t,type:"error"}),!1}}),!1}),!1}function submitForm(t){var e=$(t);e.val("发送中...");var n=$("#post-title"),i=$("#text").val(),t=new Date,t=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate();if(0<i.length&&""!==i&&n.val(i.substring(0,25)),"default"===indexInput.nowtype)0!==i.length&&""!==i||n.val("图文小记事~"+t),1===indexInput.additionArray.length?(i+="\n\n",indexInput.additionArray.forEach(function(t){i=i+"![]("+t+")"}),i+="\n\n"):1<indexInput.additionArray.length&&(i+="\n[gallery]",indexInput.additionArray.forEach(function(t){i=i+"![]("+t+")"}),i+="[endgallery]\n");else if("link"===indexInput.nowtype){if(!(0<indexInput.additionArray.length))return $.message({title:"提示",message:"请输入正确链接",type:"warning"}),e.val("发送"),!1;0<indexInput.additionArray[1].length&&""!==indexInput.additionArray[1]?n.val(indexInput.additionArray[1].substring(0,15)):n.val("分享一个链接~"+t),i=i?'[pureLink comment="'+i+'..." text="'+indexInput.additionArray[1]+'" link="'+indexInput.additionArray[0]+'"]':'[pureLink comment="'+indexInput.additionArray[1].substring(0,60)+'..." text="'+indexInput.additionArray[1]+'" link="'+indexInput.additionArray[0]+'"]'}else if("video"===indexInput.nowtype){if(!(0<indexInput.additionArray.length))return $.message({title:"提示",message:"请输入正确链接",type:"warning"}),e.val("发送"),!1;0!==i.length&&""!==i||n.val("分享视频~"+t),indexInput.additionArray.forEach(function(t){i=i+'\n[video src="'+t+'"]\n'})}else if("bilibili"===indexInput.nowtype){if(!(0<indexInput.additionArray.length))return $.message({title:"提示",message:"请输入正确链接",type:"warning"}),e.val("发送"),!1;0!==i.length&&""!==i||n.val("分享bilibili视频~"+t),indexInput.additionArray.forEach(function(t){i=i+'\n[bilibili bv="'+t+'" p="1"]\n'})}if(0===i.length||""===i)return $.message({title:"提示",message:"要不输入点东西吧~",type:"warning"}),e.val("发送"),!1;var a=!1,o=$("#category").val();return"undefined"==typeof allCategories?$.message({title:"提示",message:"还没有创建圈子",type:"error"}):(allCategories.forEach(function(t){t[1]===o&&(a=!0)}),!1===a&&(o=allCategories[0][1]),postArticle({title:n.val(),text:i,"fields[articleType]":indexInput.nowtype,markdown:1,"category[]":o,name:$("#ad-name").val(),district:$("#ad-district").val(),address:$("#ad-address").val(),visibility:"publish",allowComment:1,allowPing:1,allowFeed:1,do:"publish"},!0)),!1}function del_article(t,e){t=$(t).attr("href");return!0===confirm("您真的确定要删除吗？")&&$.ajax({url:t,method:"post",success:function(t){$.message({title:"提示",message:"删除成功！",type:"success"})},error:function(t){$.message({title:"提示",message:"删除成功！",type:"success"})}}),!1}function videoToggle(t,e,n){return $(e).hasClass("video-slim")?($(e).children().children("span:first-child").html('<svg class="bi bi-arrows-angle-contract" width=".7em" height=".7em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" d="M9.5 2.036a.5.5 0 0 1 .5.5v3.5h3.5a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 .5-.5z"/>\n  <path fill-rule="evenodd" d="M14.354 1.646a.5.5 0 0 1 0 .708l-4.5 4.5a.5.5 0 1 1-.708-.708l4.5-4.5a.5.5 0 0 1 .708 0zm-7.5 7.5a.5.5 0 0 1 0 .708l-4.5 4.5a.5.5 0 0 1-.708-.708l4.5-4.5a.5.5 0 0 1 .708 0z"/>\n  <path fill-rule="evenodd" d="M2.036 9.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V10h-3.5a.5.5 0 0 1-.5-.5z"/>\n</svg>'),$(e).children().children("span:last-child").text("收缩"),$(e).removeClass("video-slim")):($(e).children().children("span:first-child").html('<svg width=".7em" height=".7em" viewBox="0 0 16 16" class="bi bi-arrows-angle-expand" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707z"/>\n</svg>'),$(e).children().children("span:last-child").text("展开"),$(e).addClass("video-slim")),$(t).collapse("toggle"),n.stopPropagation(),!1}function checkURL(t){return!0===new RegExp(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/).test(t)}function gotoHash(t,e){0!==t.length&&0!==$(t).length&&(null==e&&(e=200),$("body,html").animate({scrollTop:$(t).offset().top-80},e))}